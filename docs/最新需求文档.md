# GitHub 同步型 Markdown 笔记本软件需求规格说明书
## 1. 项目概述
### 1.1 项目目标
开发一款**本地优先、体积轻量**的 Markdown 笔记本软件，以 GitHub 作为远程存储后端，支持笔记的创建、编辑、同步、加密管理，提供多级目录组织、标签检索、主题切换等核心功能，同时支持 Mermaid 流程图渲染与外部接口调用，兼顾易用性与扩展性。

### 1.2 核心价值
- 数据主权：笔记存储于用户自有 GitHub 仓库，无第三方数据托管风险
- 轻量化：本地运行，不依赖云端服务器，启动快速、资源占用低
- 专业性：深度优化 Markdown 编辑体验，支持技术笔记常用的流程图渲染
- 安全性：支持自定义密钥加密，敏感内容全程加密存储与传输

### 1.3 目标用户
需要跨设备同步技术笔记、重视数据隐私、习惯使用 Markdown 格式的开发者/知识管理者

## 2. 功能需求规格
### 2.1 项目初始化与配置
#### 2.1.1 首次启动配置
1. 提供三种初始化方式，用户必选其一：
   - 「关联 GitHub 仓库」：用户输入 GitHub 仓库 URL（支持 HTTPS/SSH 协议）、个人访问令牌（PAT，需具备 `repo` 权限），软件自动克隆仓库至本地指定目录
   - 「创建本地项目」：用户选择本地空目录，软件自动初始化 Git 仓库（含基础目录结构），支持后续关联 GitHub 仓库
   - 「打开本地目录」：用户选择已存在的 Git 仓库目录（需符合软件目录规范），直接加载笔记内容
2. 配置存储：所有配置（GitHub 令牌、密钥、主题设置等）仅存储于本地，不上传至 GitHub，支持手动导出备份

#### 2.1.2 目录结构规范
软件强制采用以下目录结构，确保同步一致性：
```
笔记根目录/
├─ .github-notebook/  # 软件配置目录（不上传 GitHub）
│  ├─ config.json     # 基础配置
│  ├─ theme/          # 主题文件
│  └─ encryption/     # 加密密钥（本地仅存）
├─ 一级笔记本1/       # 1级目录（最多100个）
│  ├─ 二级笔记本1/     # 2级目录（最多100个）
│  │  ├─ 三级笔记本1/  # 3级目录（最多100个）
│  │  │  ├─ 笔记1.md   # Markdown 笔记文件
│  │  │  ├─ 笔记2.md
│  │  │  └─ file/      # 笔记1/2的附件目录
│  │  │     ├─ 图片.png
│  │  │     └─ 文档.pdf
│  └─ 笔记3.md        # 二级目录下直接存储的笔记
└─ 一级笔记本2/
```
- 目录层级严格限制为3级，超出则禁止创建
- 每个笔记文件对应独立的 `file` 目录（创建笔记时自动生成），附件仅存储于对应目录
- `.github-notebook` 目录添加至 `.gitignore`，确保不上传 GitHub

### 2.2 笔记本（目录）管理
1. 操作功能：支持创建、删除、重命名、拖拽调整层级（仅支持同级别或子级拖拽，不可跨级跳过）
2. 显示规则：
   - 左侧导航栏展示完整目录树，支持折叠/展开
   - 目录名称不允许包含特殊字符（`/ \ : * ? " < > |`），长度限制 1-64 字符
   - 删除目录时需确认，删除后同步至 GitHub（含目录下所有笔记及附件）

### 2.3 笔记核心功能
#### 2.3.1 Markdown 编辑与预览
1. 编辑模式：
   - 分栏模式：左侧编辑区 + 右侧预览区，实时同步（编辑内容变动后 500ms 内更新预览）
   - 全屏编辑：隐藏所有导航与工具栏，仅保留编辑区
   - 全屏预览：隐藏所有导航与工具栏，仅保留预览区
2. 编辑区特性：
   - 语法高亮：支持 Markdown 标准语法、代码块语法高亮（支持 100+ 编程语言）
   - 自动补全：Markdown 语法（如 `#` `*` `[]()`）、标签（输入 `#` 触发已存标签联想）
   - 快捷键支持：符合主流编辑器习惯（如 `Ctrl+B` 加粗、`Ctrl+I` 斜体、`Ctrl+K` 插入链接）
3. 预览区特性：
   - 支持标准 Markdown 语法渲染（标题、列表、表格、代码块、引用等）
   - 支持 Mermaid 流程图渲染（集成 mermaid-js 引擎，支持所有 Mermaid 图表类型）
   - 图片预览：支持本地图片（`file/` 目录下）、网络图片、Base64 图片
   - 链接跳转：内部笔记链接（`[笔记名称](笔记路径.md)`）点击跳转至对应笔记，外部链接默认浏览器打开

#### 2.3.2 笔记操作
1. 基础操作：创建、删除、重命名、复制、移动（支持跨目录移动，移动后附件目录同步迁移）
2. 自动保存：编辑过程中每 1 秒自动保存本地文件，避免内容丢失
3. 文件命名：笔记文件后缀固定为 `.md`，文件名不允许包含特殊字符（`/ \ : * ? " < > |`），长度限制 1-64 字符

#### 2.3.3 附件上传与管理
1. 上传功能：
   - 支持拖拽文件至编辑区/预览区上传，或通过「上传文件」按钮选择
   - 上传后自动存储至当前笔记对应的 `file` 目录，文件名保留原始名称（若重复则在文件名后添加 `_1` `_2` 后缀）
   - 支持上传文件类型：无限制（图片、文档、压缩包等），单个文件大小限制 500MB
2. 引用规则：上传成功后自动在编辑区插入引用语法（图片：`![文件名](file/文件名.后缀)`，其他文件：`[文件名](file/文件名.后缀)`）
3. 管理功能：支持在软件内查看 `file` 目录下的附件列表，可下载、删除、重命名附件（同步更新笔记内引用链接）

### 2.4 标签管理
1. 标签存储：标签信息嵌入 Markdown 文件头部的 YAML Front Matter，格式如下：
   ```markdown
   ---
   tags: [标签1, 标签2, 技术, GitHub]
   updatedAt: 2026-01-18 10:00:00
   ---
   笔记内容...
   ```
   - YAML 块仅支持 `tags` 和 `updatedAt` 字段，用户不可手动修改 `updatedAt`（由软件自动维护）
   - 标签数量无限制，单个标签长度 1-32 字符，不允许包含 `, [ ] " '` 字符
2. 操作功能：
   - 笔记编辑页提供标签输入框，支持添加、删除、修改标签（实时同步至 YAML 块）
   - 支持标签模糊搜索（输入关键词匹配标签名称）
3. 全局标签管理：左侧导航栏提供「标签云」，展示所有标签及关联笔记数量，点击标签可筛选对应笔记

### 2.5 搜索与排序
#### 2.5.1 搜索功能
1. 搜索范围：笔记标题、笔记内容、标签
2. 搜索规则：
   - 支持精确搜索（输入关键词加引号，如 `"GitHub 同步"`）
   - 支持标签筛选（输入 `#标签名` 仅搜索对应标签的笔记）
   - 搜索结果实时展示，高亮匹配关键词
   - 支持按搜索范围过滤（仅标题/仅内容/仅标签）
3. 结果展示：搜索结果按「匹配度+修改时间」排序，展示笔记标题、所在目录、修改时间、匹配片段

#### 2.5.2 排序功能
1. 排序维度：仅支持按「修改时间」排序（默认降序，最新修改在前）
2. 排序范围：全局笔记、当前目录下笔记、搜索结果列表均可独立排序
3. 时间戳维护：软件自动更新笔记文件的 `updatedAt` 字段（精确到秒），并同步修改本地文件的修改时间戳

### 2.6 加密功能
#### 2.6.1 加密配置
1. 密钥管理：
   - 用户自定义密钥（长度 8-32 字符，支持大小写字母、数字、符号）
   - 密钥本地存储于 `.github-notebook/encryption/key`（加密存储，不可明文查看）
   - 支持密钥修改（修改后需重新加密所有已加密笔记，旧密钥需验证正确）
   - 提供密钥备份功能（导出为加密的 JSON 文件，需输入密钥验证后方可恢复）
2. 加密范围：笔记内容（`.md` 文件）、`file` 目录下的所有附件文件

#### 2.6.2 加密方式（用户二选一）
1. 实时加解密（默认方式）：
   - 加密触发：笔记保存时自动加密内容，加密后文件格式为 `.md.enc`（附件文件后缀添加 `.enc`）
   - 解密触发：打开笔记时自动解密（需验证密钥，首次打开会话后无需重复输入）
   - 加密算法：AES-256-GCM（军用级加密，含完整性校验）
   - GitHub 存储：仅存储加密后的文件，密钥不上传
2. 压缩包加密（备选方式）：
   - 加密触发：用户手动选择「加密打包」，将笔记及附件压缩为 ZIP 包（AES-256 加密）
   - 解密触发：用户下载 ZIP 包后，在软件内选择「解密解压」，输入密码后恢复为原始文件
   - 压缩规则：单个笔记打包为独立 ZIP 包，整个目录打包为包含完整结构的 ZIP 包

#### 2.6.3 安全规则
- 未验证密钥时，无法查看加密笔记内容（显示「该笔记已加密，请输入密钥解密」）
- 密钥输入错误累计 5 次，锁定 1 分钟（防止暴力破解）
- 加密文件删除后，同步至 GitHub 仓库（需手动在 GitHub 删除历史版本，软件不自动清理）

### 2.7 主题与样式
#### 2.7.1 主题支持
1. 默认主题：内置 3 种主流风格主题，与参考软件风格一致：
   - 「Notion 风格」：简洁白底、无衬线字体、弱对比色
   - 「印象笔记风格」：米白底、宋体/无衬线字体切换、强标题对比
   - 「有道云笔记风格」：浅灰底、圆润字体、卡片式布局
2. 主题切换：顶部工具栏提供主题切换按钮，实时生效，切换后自动保存配置
3. 自定义主题：
   - 支持导入自定义 CSS 文件（放置于 `.github-notebook/theme/` 目录）
   - 提供主题编辑面板，支持修改字体（系统字体/自定义字体文件）、字号（12-24px）、行高（1.2-2.0）、颜色（背景色、文字色、标题色等）
   - 支持浅色/深色模式自动切换（跟随系统设置）

#### 2.7.2 Markdown 样式扩展
1. 基础样式优化：
   - 标题层级：H1-H6 字体大小、粗细、间距差异化明显
   - 代码块：支持自定义背景色、边框、字体大小，显示行号
   - 引用块：支持自定义边框颜色、背景色、斜体样式
   - 列表：有序列表/无序列表缩进一致，嵌套列表样式区分明显
2. 扩展样式：
   - 支持任务列表（`- [x] 已完成` `-[ ] 未完成`）渲染
   - 支持表格样式美化（交替行背景色、边框合并）
   - 支持脚注（`[^1]`）渲染
   - 支持高亮语法（`==高亮内容==`）

### 2.8 导出功能
1. 导出范围：
   - 单篇笔记导出：导出当前编辑的笔记（含 `file` 目录下的附件）
   - 目录导出：导出选中目录下的所有笔记及子目录（保留目录结构）
2. 导出格式：
   - Markdown 格式：导出为原始 `.md` 文件 + 对应的 `file` 目录（保持相对路径）
   - PDF 格式：将 Markdown 内容（含 Mermaid 图表）渲染为 PDF，附件单独打包
   - HTML 格式：导出为单个 HTML 文件（含内嵌样式、图片 Base64 编码），支持离线打开
3. 导出规则：
   - 导出加密笔记时，需先解密（验证密钥后导出明文内容）
   - 导出文件命名：单篇笔记以笔记名为文件名，目录导出以目录名为压缩包名（ZIP 格式）
   - 支持选择导出路径，默认导出至「用户文档/GitHub笔记本导出」目录

### 2.9 同步功能
#### 2.9.1 同步机制
1. 同步触发方式：
   - 手动同步：用户点击顶部工具栏「同步」按钮，执行拉取（pull）→ 推送（push）流程
   - 自动同步：用户可设置自动同步间隔（5分钟/15分钟/30分钟，默认关闭），间隔内有修改则自动触发同步
2. 同步逻辑：
   - 拉取（pull）：从 GitHub 仓库拉取最新版本，若存在冲突则触发冲突解决机制
   - 推送（push）：将本地修改（创建/编辑/删除笔记、目录、附件）提交至 GitHub，提交信息自动生成（格式：`[笔记本软件] 操作类型: 内容 - 时间戳`，如 `[笔记本软件] 编辑笔记: GitHub同步指南 - 2026-01-18 10:30:00`）
3. 冲突处理：
   - 冲突检测：拉取时对比文件 SHA 值，识别冲突文件
   - 冲突解决：弹出冲突解决窗口，展示「本地版本」「远程版本」「合并版本」，用户手动选择保留内容，确认后重新提交

#### 2.9.2 同步状态展示
- 顶部状态栏显示同步状态（未同步/同步中/同步成功/同步失败）
- 同步失败时显示错误提示（如网络异常、GitHub 令牌失效、仓库权限不足），提供重试按钮
- 支持查看同步日志（最近 100 条同步记录，含时间、操作、结果）

### 2.10 外部调用接口（MCP）
1. 接口类型：本地 IPC 接口（支持跨进程调用）
2. 接口功能：仅提供「获取笔记内容」功能，具体规格：
   - 接口名称：`getNoteContent`
   - 请求参数：
     - `notePath`：笔记相对路径（如 `一级笔记本/二级笔记本/笔记.md`）
     - `needDecrypt`：是否需要解密（布尔值，默认 `true`）
     - `apiKey`：软件生成的 API 密钥（用户在设置中启用接口时自动生成）
   - 返回结果：
     - 成功：`{ code: 200, data: { title: 笔记标题, content: Markdown 内容, tags: [标签列表], updatedAt: 修改时间 } }`
     - 失败：`{ code: 4xx/5xx, message: 错误信息 }`（如密钥错误、笔记不存在、笔记未解密）
3. 权限控制：用户需手动启用接口功能，可重置 API 密钥，支持禁用接口
4. 调用示例（Node.js）：
   ```javascript
   const { ipcRenderer } = require('electron');
   ipcRenderer.send('getNoteContent', {
     notePath: '技术笔记/GitHub/同步指南.md',
     needDecrypt: true,
     apiKey: 'user-generated-api-key-123'
   });
   ipcRenderer.on('noteContentResult', (event, result) => {
     console.log(result);
   });
   ```

## 3. 非功能需求
### 3.1 性能要求
1. 客户端体积：
   - Windows 版本：安装包体积 ≤ 30MB，运行时占用内存 ≤ 100MB
   - macOS 版本：安装包体积 ≤ 40MB，运行时占用内存 ≤ 120MB
   - Linux 版本：安装包体积 ≤ 35MB，运行时占用内存 ≤ 110MB
2. 启动速度：从双击图标到加载完成 ≤ 3 秒（首次启动 ≤ 5 秒）
3. 同步速度：单篇笔记同步 ≤ 1 秒，100 篇以内笔记批量同步 ≤ 10 秒
4. 渲染速度：Mermaid 流程图（≤ 100 节点）渲染 ≤ 500ms，Markdown 预览实时同步延迟 ≤ 500ms

### 3.2 稳定性要求
1. 无崩溃：连续运行 72 小时无崩溃，编辑过程中无闪退
2. 数据安全：异常退出（如断电、强制关闭）后，重新启动无内容丢失
3. 同步可靠性：网络中断后恢复，同步功能可正常重试，无数据冲突丢失

### 3.3 兼容性要求
1. 操作系统：
   - Windows：支持 Windows 10 及以上（32/64 位）
   - macOS：支持 macOS 12 及以上
   - Linux：支持 Ubuntu 20.04 及以上、CentOS 8 及以上
2. Git 版本：支持 Git 2.20.0 及以上
3. GitHub 兼容性：支持公开仓库、私有仓库，支持 GitHub Enterprise 版本
4. Markdown 兼容性：支持 GitHub Flavored Markdown（GFM）标准，兼容主流编辑器生成的 Markdown 文件

### 3.4 易用性要求
1. 交互逻辑：符合主流笔记软件操作习惯，无学习成本
2. 错误提示：所有操作错误（如同步失败、密钥错误、文件冲突）提供明确提示和解决方案
3. 帮助文档：内置简易帮助手册，涵盖初始化配置、同步操作、加密使用等核心流程

## 4. 技术要求
### 4.1 开发语言与框架
- 可选技术栈：
  1. Node.js + Electron（优势：开发效率高，生态丰富；需优化体积与性能）
  2. Rust + Tauri（优势：体积小，性能优；需适配跨平台渲染）
- 渲染引擎：Markdown 渲染采用 marked.js 或 pulldown-cmark，Mermaid 渲染采用 mermaid-js
- 加密库：Node.js 可选 crypto 模块，Rust 可选 aes-gcm  crate（均需支持 AES-256-GCM）
- GitHub 交互：使用 GitHub REST API v3/v4，认证方式为 PAT 令牌

### 4.2 依赖工具
- 必须依赖：Git（用户需提前安装，软件启动时检测，未安装则提示引导安装）
- 可选依赖：7-Zip（用于压缩包加密，Windows 版本内置便携版，macOS/Linux 调用系统自带压缩工具）

### 4.3 存储要求
- 本地存储：仅存储配置文件、密钥、缓存数据（缓存数据可手动清理）
- 远程存储：仅通过 Git 同步笔记文件、附件文件，不存储任何配置信息

### 4.4 安全要求
- 密钥安全：密钥本地存储时需加密（使用设备硬件信息生成临时密钥加密存储），不明文存储
- 网络传输：所有与 GitHub 的通信必须通过 HTTPS 协议，禁止 HTTP
- 数据隔离：加密笔记与普通笔记分开存储，避免误操作泄露

## 5. 交互规范
### 5.1 界面布局
1. 整体布局：
   - 左侧：导航栏（目录树 + 标签云 + 搜索框），可折叠（最小宽度 200px，最大宽度 400px）
   - 中间：编辑/预览区（分栏模式可调整宽度比例，全屏模式占满窗口）
   - 顶部：工具栏（文件操作、同步、主题、导出、设置等按钮）
   - 底部：状态栏（同步状态、字数统计、当前目录路径）
2. 响应式设计：支持窗口缩放（最小宽度 800px，最小高度 600px），缩放时布局自适应调整

### 5.2 核心操作流程
#### 5.2.1 笔记创建流程
1. 左侧导航栏选中目标目录 → 点击「新建笔记」按钮 → 输入笔记名称 → 确认创建
2. 自动打开笔记编辑页（分栏模式），自动插入默认 YAML Front Matter → 用户编辑内容
3. 编辑过程中自动保存 → 点击「同步」按钮 → 提交至 GitHub

#### 5.2.2 加密笔记流程
1. 笔记编辑页点击「加密」按钮 → 选择加密方式（实时加解密/压缩包加密）
2. 输入密钥 → 二次确认密钥 → 点击「确认加密」
3. 实时加解密：自动加密当前笔记，文件后缀变更为 `.md.enc` → 同步至 GitHub
4. 压缩包加密：生成 ZIP 加密包 → 保存至指定路径 → 可选择是否删除原文件

#### 5.2.3 同步流程
1. 点击顶部「同步」按钮 → 软件自动执行 Git pull → 无冲突则执行 Git push
2. 有冲突 → 弹出冲突解决窗口 → 用户选择保留内容 → 确认后执行 Git push
3. 同步成功 → 状态栏显示「同步成功」（5秒后消失）
4. 同步失败 → 状态栏显示「同步失败：错误信息」→ 提供「重试」「查看日志」按钮

### 5.3 快捷键规范
| 功能 | Windows/Linux 快捷键 | macOS 快捷键 |
|------|----------------------|--------------|
| 新建笔记 | Ctrl+N | Command+N |
| 打开笔记 | Ctrl+O | Command+O |
| 保存笔记 | Ctrl+S | Command+S |
| 同步 | Ctrl+Sync | Command+Sync |
| 加粗 | Ctrl+B | Command+B |
| 斜体 | Ctrl+I | Command+I |
| 插入链接 | Ctrl+K | Command+K |
| 插入图片 | Ctrl+P | Command+P |
| 全屏编辑 | F11 | F11 |
| 全屏预览 | Shift+F11 | Shift+F11 |
| 导出当前笔记 | Ctrl+E | Command+E |
| 搜索 | Ctrl+F | Command+F |
| 关闭窗口 | Ctrl+W | Command+W |

## 6. 验收标准
### 6.1 功能验收
所有需求文档中列出的功能点必须全部实现，无遗漏，且符合操作逻辑
### 6.2 性能验收
- 客户端体积符合 3.1 节要求
- 启动速度、同步速度、渲染速度符合 3.1 节要求
- 连续运行 72 小时无崩溃，异常退出后无数据丢失
### 6.3 兼容性验收
- 在 4.3 节列出的所有操作系统版本上可正常运行
- 与 Git 2.20.0 及以上版本兼容
- 与 GitHub 公开仓库、私有仓库均能正常同步
### 6.4 安全验收
- 加密笔记在未输入密钥时无法查看内容
- 密钥存储无明文泄露风险
- 同步过程中数据传输通过 HTTPS 协议
