# 回收站功能文档 (Trash Features)

本文档详细说明了应用中的回收站功能，包括数据恢复机制、持久化存储以及代码实现细节。

## 1. 功能概述

回收站功能用于临时存储用户删除的文件，提供恢复（Restore）和永久删除（Permanently Delete）的能力，防止误删操作造成数据丢失。

主要特性包括：
- **逻辑删除**: 文件被移入回收站而非直接物理删除。
- **列表查看**: 展示回收站中的所有项目（名称、原路径、删除时间、大小）。
- **文件恢复**: 支持单选或多选恢复文件到原路径。
- **永久清理**: 支持单选永久删除或一次性清空回收站。

## 2. 核心逻辑

### 2.1 数据存储与管理
- **TrashStore**: 负责管理回收站内的文件元数据。
- **Metadata**: 记录每个删除项的：
    - `id`: 唯一标识符。
    - `originalPath`: 删除时的原始文件路径。
    - `name`: 文件名。
    - `deletedAt`: 删除时间戳。
    - `size`: 文件大小（可选）。
- **Persistence**: 元数据持久化存储在 `trash.json` 或类似配置文件中。

### 2.2 交互逻辑
- **移入回收站**:
    - 用户在 Sidebar 或 File Tree 触发删除操作。
    - 系统将文件实际移动到 `.trash` 隐藏目录（或仅记录路径并逻辑移动，视实现而定，当前版本推荐物理移动到特定目录）。
    - 更新 `TrashStore` 状态。
- **恢复文件**:
    - 检查原路径是否已被占用（如有重名，自动重命名如 `copy`）。
    - 将文件从 `.trash` 目录移动回 `originalPath`。
    - 从 `TrashStore` 移除记录。
- **永久删除**:
    - 直接从磁盘物理删除文件。
    - 从 `TrashStore` 移除记录。

## 3. 架构与实现

### 3.1 目录结构

```
src/
  ├── store/
  │   └── TrashStore.ts       # MobX Store，管理回收站状态和操作
  ├── components/
  │   └── TrashDialog/
  │       └── TrashPage.tsx   # 主页面组件 (全屏视图)
  └── types/                  # 类型定义 (TrashItem)
```

### 3.2 页面重构
原 `TrashDialog` (Modal) 已重构为 `TrashPage` (全屏页面)，以提供更清晰的文件列表展示和批量操作体验（未来支持）。

### 3.3 关键组件
- **TrashPage**:
    - 列表展示：使用表格或列表形式展示删除项。
    - 操作栏：提供 "清空回收站" (`Empty Trash`) 和 "恢复选中" (`Restore`) 按钮。
- **TrashStore**:
    - `trashItems`: 当前回收站内的文件列表。
    - `moveToTrash(path)`: 执行移入回收站逻辑。
    - `restoreItem(id)`: 执行恢复逻辑。
    - `deleteItem(id)`: 执行永久删除逻辑。
    - `emptyTrash()`: 清空所有。

## 4. UI 设计

- **布局**: 顶部操作栏 + 内容列表区。
- **视觉风格**:
    - 列表项包含图标、名称、原位置、删除日期。
    - "永久删除" 操作使用红色危险按钮样式。
    - 空状态显示友好的提示插图。

## 5. 注意事项

- **路径冲突**: 恢复时若原路径存在同名文件，需由后端（Electron/Node）处理重命名策略，前端展示相应提示。
- **大文件**: 对于极大文件的删除，建议绕过回收站直接提示永久删除（视配置而定）。
